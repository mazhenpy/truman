"use strict";function getQueryStringByName(n){var t=location.search.match(new RegExp("[?&]"+n+"=([^&]+)","i"));return t==null||t.length<1?"":t[1]}var CARD_TYPE=getQueryStringByName("card_type"),MainContent=React.createClass({displayName:"MainContent",getInitialState:function(){return{}},componentDidMount:function(){},componentDidUpdate:function(){},render:function(){return React.createElement("div",{className:"wrapper"},React.createElement(DownstreamUserList,null))}}),DownstreamUserList=React.createClass({displayName:"DownstreamUserList",onClickDeleteCardPool:function(n,t){var i,u,r,f;if(window.confirm(_.str.sprintf("确认删除用户 %s 的卡池 %s 吗?",n.user_name,t))){i=this.state.user_list;u=[];for(r in i)n.user_id==i[r].user_id?(f=i[r].card_pool_list.indexOf(t),i[r].card_pool_list.splice(f,1),u.push(i[r])):u.push(i[r]);this.setState({user_list:u})}},onClickDeleteUser:function(n){if(window.confirm(_.str.sprintf("确认删除用户 %s %s 吗?",n.user_id,n.user_name))){var t={requ_type:"remove_user",argu_list:{user_info:n}};$.ajax({url:_.str.sprintf("/admin/card_pool_list?card_type=%s",encodeURIComponent(CARD_TYPE)),type:"post",dataType:"json",data:JSON.stringify(t),success:function(n){n.status=="ok"?(this.getUserList(),alert("删除用户成功")):alert("删除用户出错 "+n.msg)}.bind(this),error:function(n,t,i){alert("删除用户异常 "+i.toString());console.error(this.props.url,t,i.toString())}.bind(this)})}},onClickAddUser:function(){this.refs.AddUserDlg.showDlg(this.state.user_list,this.onAddUserOk)},onAddUserOk:function(n){var t={requ_type:"add_user",argu_list:{new_user_info:n}};$.ajax({url:_.str.sprintf("/admin/card_pool_list?card_type=%s",encodeURIComponent(CARD_TYPE)),type:"post",dataType:"json",data:JSON.stringify(t),success:function(n){n.status=="ok"?(this.getUserList(),alert("新增用户成功")):alert("新增用户出错 "+n.msg)}.bind(this),error:function(n,t,i){alert("新增用户异常 "+i.toString());console.error(this.props.url,t,i.toString())}.bind(this)})},onClickChooseCardPool:function(n,t){this.refs.ChooseUserCardPoolDlg.showDlg(n,t,this.state.card_pool_list,this.onChooseCardPoolOk)},onChooseCardPoolOk:function(n,t,i){var r={requ_type:"set_user_card_pool",argu_list:{user_info:n,card_pool_seq:t,card_pool_name:i}};$.ajax({url:_.str.sprintf("/admin/card_pool_list?card_type=%s",encodeURIComponent(CARD_TYPE)),type:"post",dataType:"json",data:JSON.stringify(r),success:function(n){n.status=="ok"?this.getUserList():alert("修改卡池出错 "+n.msg)}.bind(this),error:function(n,t,i){alert("修改卡池异常 "+i.toString());console.error(this.props.url,t,i.toString())}.bind(this)})},getUserList:function(){$.ajax({url:_.str.sprintf("/admin/card_pool_list?card_type=%s&requ_type=%s",encodeURIComponent(CARD_TYPE),encodeURIComponent("get_user_list")),type:"get",dataType:"json",success:function(n){n.status=="ok"?this.setState({user_list:n.data.user_list}):alert("用户列表加载错误 "+n.msg)}.bind(this),error:function(n,t,i){alert("用户列表加载异常 "+i.toString());console.error(this.props.url,t,i.toString())}.bind(this)})},getCardPoolList:function(){$.ajax({url:_.str.sprintf("/admin/card_pool_list?card_type=%s&requ_type=%s",encodeURIComponent(CARD_TYPE),encodeURIComponent("get_pool_list")),type:"get",dataType:"json",success:function(n){n.status=="ok"?this.setState({card_pool_list:n.data.pool_list}):alert("用户列表加载错误 "+n.msg)}.bind(this),error:function(n,t,i){alert("用户列表加载异常 "+i.toString());console.error(this.props.url,t,i.toString())}.bind(this)})},getInitialState:function(){return{card_pool_list:[],user_list:[]}},componentDidMount:function(){this.getUserList();this.getCardPoolList()},componentDidUpdate:function(){},render:function(){var n=this.state.user_list.map(function(n){var t=n.card_pool_seq_list.map(function(t,i){var r=n[t];return r==""?React.createElement("a",{href:"javascript:void(0);",className:"btn btn-sm btn-default",style:{border:"1px dashed #CACACA",padding:"0 20px"},onClick:this.onClickChooseCardPool.bind(this,n,t)},React.createElement("i",{className:"icon-plus"})):React.createElement("a",{href:"javascript:void(0);",className:"btn btn-sm btn-info",style:{padding:"0px 10px"},onClick:this.onClickChooseCardPool.bind(this,n,t)},i+1,". ",r)}.bind(this)),i=React.createElement("a",{href:"javascript:void(0);",className:"btn btn-sm btn-danger",style:{padding:"0 10px"},onClick:this.onClickDeleteUser.bind(this,n)},React.createElement("i",{className:"icon-remove"})," ","删除");return React.createElement("tr",null,React.createElement("td",null,n.user_id),React.createElement("td",null,n.user_name),React.createElement("td",null,t),React.createElement("td",null,i))}.bind(this));return React.createElement("div",{className:"col-md-12"},React.createElement("div",{className:"panel"},React.createElement("div",{className:"panel-heading row"},React.createElement("span",{className:"pull-left"},React.createElement("i",{className:"icon-th-list"}),"用户列表"),React.createElement("span",{className:"pull-right"},React.createElement("a",{className:"btn btn-info",href:"javascript:void(0);",onClick:this.onClickAddUser},React.createElement("i",{className:"icon-plus"})," 新增用户"))),React.createElement("div",{className:"panel-body"},React.createElement("table",{className:"table table-responsive table-striped table-hover"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"用户ID"),React.createElement("th",null,"名称"),React.createElement("th",null,"卡池使用表"),React.createElement("th",null,"操作"))),React.createElement("tbody",null,n)))),React.createElement(AddUserDlg,{ref:"AddUserDlg"}),React.createElement(ChooseUserCardPoolDlg,{ref:"ChooseUserCardPoolDlg"}))}}),AddUserDlg=React.createClass({displayName:"AddUserDlg",clearInput:function(){this.setState({user_list:[],onClickOk:null})},onOk:function(){var n={user_id:$("#new_user_id").val(),user_name:$("#new_user_name").val()};this.state.onClickOk(n);this.hideDlg()},onInputKeyUp:function(n){var i,t;$("#"+n).keydown(function(t){if(!t)var t=window.event;n=="new_user_id"?t.keyCode>=48&&t.keyCode<=57||t.keyCode>=96&&t.keyCode<=105||t.keyCode==8||t.keyCode==0||(t.preventDefault(),t.stopPropagation()):t.keyCode==32&&(t.preventDefault(),t.stopPropagation())});i=$("#new_user_id").val();i.length!=6||i==null||i==""||i=="null"?($("#new_user_name").attr({disabled:"disabled"}),$("#new_user_id_msg").show()):($("#new_user_id_msg").hide(),$("#new_user_name").removeAttr("disabled"),t=$("#new_user_name").val(),t==""||t==null||t=="null"?$("#new_user_name_msg").show():i.length==6&&t!=""&&t!=null&&t!="null"&&($("#new_user_id_msg").hide(),$("#new_user_name_msg").hide(),$("#addokbtn").removeClass("disabled")));$("#"+n).val(value)},showDlg:function(n,t){this.setState({user_list:n,onClickOk:t});$("#AddUserDlg").modal({backdrop:"static",keyboard:!1});$("#new_user_id").val("");$("#new_user_name").val("");$("#new_user_id_msg").hide();$("#new_user_name_msg").hide();$("#new_user_name").attr({disabled:"disabled"});$("#addokbtn").addClass("disabled")},hideDlg:function(){this.clearInput();$("#AddUserDlg").modal("hide")},getInitialState:function(){return{user_list:[],onClickOk:null}},componentDidMount:function(){},render:function(){return React.createElement("div",{className:"modal",id:"AddUserDlg",tabIndex:"-1",role:"dialog"},React.createElement("div",{className:"modal-dialog"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},"新增卡池用户")),React.createElement("div",{className:"modal-body form-horizontal"},React.createElement("div",{className:"form-group add-pro-body"},React.createElement("div",{className:"row"},React.createElement("label",{className:"col-xs-2 control-label"},"用户ID"),React.createElement("div",{className:"col-xs-6"},React.createElement("input",{maxLength:"6",className:"m-bot15 form-control input-sm",id:"new_user_id",placeholder:"请输入六位数的用户ID",onBlur:this.onInputKeyUp.bind(this,"new_user_id"),onKeyUp:this.onInputKeyUp.bind(this,"new_user_id")})),React.createElement("span",{className:"col-xs-3 alert alert-danger",id:"new_user_id_msg",style:{display:"none",padding:"5"}},React.createElement("i",{className:"icon-remove"})," 用户ID必须为六位")),React.createElement("div",{className:"row"},React.createElement("label",{className:"col-xs-2 control-label"},"用户名称"),React.createElement("div",{className:"col-xs-6"},React.createElement("input",{maxLength:"15",className:"m-bot15 form-control input-sm",id:"new_user_name",placeholder:"请输入用户名称",onBlur:this.onInputKeyUp.bind(this,"new_user_name"),onKeyUp:this.onInputKeyUp.bind(this,"new_user_name")})),React.createElement("span",{className:"col-xs-3 alert alert-danger",id:"new_user_name_msg",style:{display:"none",padding:"5"}},React.createElement("i",{className:"icon-remove"})," 用户名称不能为空")))),React.createElement("div",{className:"modal-footer form-horifooter"},React.createElement("button",{type:"button",id:"addokbtn",className:"btn btn-danger",onClick:this.onOk},"增加"),React.createElement("button",{type:"button",className:"btn btn-default","data-dismiss":"modal"},"取消")))))}}),ChooseUserCardPoolDlg=React.createClass({displayName:"ChooseUserCardPoolDlg",onOk:function(){this.state.onClickOk(this.state.user_info,this.state.card_pool_seq,$("#user_select_card_pool").val());this.hideDlg()},showDlg:function(n,t,i,r){var u=[{pool_name:""}];u=u.concat(i);console.info(u);this.setState({user_info:n,card_pool_seq:t,card_pool_list:u,onClickOk:r});$("#ChooseUserCardPoolDlg").modal("show")},hideDlg:function(){$("#ChooseUserCardPoolDlg").modal("hide");this.clearDlgData()},clearDlgData:function(){this.setState({user_info:null,card_pool_seq:null,card_pool_list:[],onClickOk:null})},getInitialState:function(){return{user_info:null,card_pool_seq:null,card_pool_list:[],onClickOk:null}},componentDidMount:function(){},componentDidUpdate:function(){},render:function(){var n=this.state.card_pool_list.map(function(n){return n.pool_name==""?React.createElement("option",{value:n.pool_name},"(空)"):React.createElement("option",{value:n.pool_name},n.pool_name)}.bind(this));return React.createElement("div",{className:"modal",id:"ChooseUserCardPoolDlg",tabIndex:"-1",role:"dialog"},React.createElement("div",{className:"modal-dialog"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},"选择卡池")),React.createElement("div",{className:"modal-body form-horizontal"},React.createElement("div",{className:"form-group add-pro-body"},React.createElement("div",{className:"col-md-12"},React.createElement("select",{className:"form-control",id:"user_select_card_pool"},n)))),React.createElement("div",{className:"modal-footer form-horifooter"},React.createElement("button",{type:"button",className:"btn btn-danger",onClick:this.onOk},"确定"),React.createElement("button",{type:"button",className:"btn btn-default","data-dismiss":"modal"},"取消")))))}});React.render(React.createElement(MainContent,null),document.getElementById("main-content"));