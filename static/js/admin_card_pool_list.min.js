"use strict";function getQueryStringByName(n){var t=location.search.match(new RegExp("[?&]"+n+"=([^&]+)","i"));return t==null||t.length<1?"":t[1]}var CARD_TYPE=getQueryStringByName("card_type"),MainContent=React.createClass({displayName:"MainContent",getPoolList:function(){$.ajax({url:_.str.sprintf("/admin/card_pool_list?card_type=%s&requ_type=%s",encodeURIComponent(CARD_TYPE),encodeURIComponent("get_pool_list")),type:"get",dataType:"json",success:function(n){n.status=="ok"?this.setState({pool_list:n.data.pool_list}):alert("卡池列表加载错误 "+n.msg)}.bind(this),error:function(n,t,i){alert("卡池列表加载异常 "+i.toString());console.error(this.props.url,t,i.toString())}.bind(this)})},getPoolListConfig:function(){$.ajax({url:_.str.sprintf("/admin/card_pool_list?card_type=%s&requ_type=%s",encodeURIComponent(CARD_TYPE),encodeURIComponent("get_pool_list_config")),type:"get",dataType:"json",success:function(n){n.status=="ok"?this.setState({pool_list_config:n.data}):alert("卡池列表配置加载错误 "+n.msg)}.bind(this),error:function(n,t,i){alert("卡池列表配置加载异常 "+i.toString());console.error(this.props.url,t,i.toString())}.bind(this)})},getInitialState:function(){return{pool_list:[],pool_list_config:{}}},componentDidMount:function(){this.getPoolList();this.getPoolListConfig()},onClickAddPool:function(){this.refs.AddPoolDlg.showDlg(this.state.pool_list,this.onAddPool)},onAddPool:function(n){var t={requ_type:"add_pool",argu_list:{new_pool_info:n}};$.ajax({url:_.str.sprintf("/admin/card_pool_list?card_type=%s",encodeURIComponent(CARD_TYPE)),type:"post",dataType:"json",data:JSON.stringify(t),success:function(t){t.status=="ok"?(this.getPoolList(),alert(_.str.sprintf("新增卡池 %s 成功",n.pool_name))):alert(_.str.sprintf("新增卡池 %s 失败 %s!!!",n.pool_name,t.msg))}.bind(this),error:function(t,i,r){alert(_.str.sprintf("新增卡池 %s 异常 %s!!!",n.pool_name,r.toString()));console.error(this.props.url,i,r.toString())}.bind(this)})},onDelPool:function(n){if(!window.confirm(_.str.sprintf("确认删除卡池 %s 吗?",n.pool_name))){n.pool_name==this.state.pool_list_config.def_up_pool||this.state.pool_list_config.pub_use_pool;return}var t={requ_type:"remove_pool",argu_list:{pool_info:n}};$.ajax({url:_.str.sprintf("/admin/card_pool_list?card_type=%s",encodeURIComponent(CARD_TYPE)),type:"post",dataType:"json",data:JSON.stringify(t),success:function(t){t.status=="ok"?(this.getPoolList(),alert(_.str.sprintf("删除卡池 %s 成功",n.pool_name))):alert(_.str.sprintf("删除卡池 %s 失败 %s!!!",n.pool_name,t.msg))}.bind(this),error:function(t,i,r){alert(_.str.sprintf("删除卡池 %s 异常 %s!!!",n.pool_name,r.toString()));console.error(this.props.url,i,r.toString())}.bind(this)})},onClickSetDefUpPool:function(n){this.setPoolListConfig("def_up_pool",n.pool_name)},onClickSetPubUsePool:function(n){this.setPoolListConfig("pub_use_pool",n.pool_name)},setPoolListConfig:function(n,t){var i="默认卡池",r,u;(n!="def_up_pool"&&(i="公共卡池"),window.confirm(_.str.sprintf("确认将卡池 %s 设为 %s 吗?",t,i)))&&(r={},r[n]=t,u={requ_type:"set_pool_list_config",argu_list:r},$.ajax({url:_.str.sprintf("/admin/card_pool_list?card_type=%s",encodeURIComponent(CARD_TYPE)),type:"post",dataType:"json",data:JSON.stringify(u),success:function(n){n.status=="ok"?(this.getPoolListConfig(),this.getPoolList(),alert(_.str.sprintf("%s 卡池 %s 设置成功",i,t))):alert("失败!! "+n.msg)}.bind(this),error:function(n,t,i){alert(i.toString());console.error(this.props.url,t,i.toString())}.bind(this)}))},getLocalTime:function(n){return new Date(parseInt(n)*1e3).toLocaleString()},setPoolConfig:function(n,t,i){var r={},u;r.card_pool=n;r.key=t;r.value=i;u={requ_type:"set_pool_config",argu_list:r};$.ajax({url:_.str.sprintf("/admin/card_pool_list?card_type=%s",encodeURIComponent(CARD_TYPE)),type:"post",dataType:"json",data:JSON.stringify(u),success:function(t){t.status=="ok"?(this.getPoolList(),alert(_.str.sprintf("卡池 %s 设置缓存成功",n))):alert("修改卡池配置错误: "+t.msg)}.bind(this),error:function(n,t,i){alert("修改卡池配置异常: "+i.toString());console.error(this.props.url,t,i.toString())}.bind(this)})},onOpenPoolConfig:function(n){window.confirm(_.str.sprintf("确认将卡池缓存 %s 打开吗?",n))&&this.setPoolConfig(n,"need_cache",1)},onClosePoolConfig:function(n){window.confirm(_.str.sprintf("确认将卡池缓存 %s 关闭吗?",n))&&this.setPoolConfig(n,"need_cache",0)},render:function(){var t=this.state.pool_list_config.def_up_pool,n=this.state.pool_list_config.pub_use_pool,i=this.state.pool_list.map(function(i){var r=i.pool_name,s="open"+r,h="close"+r,e=null,o,u,f;return r!=n&&(e=i.need_cache==1?React.createElement("div",{className:"row"},React.createElement("div",{className:"col-xs-4 poolalert alert-success text-center"},"状态: 打开"),React.createElement("div",{className:"col-xs-2 text-right"},React.createElement("a",{id:h,href:"javascript:void(0);",className:"btn btn-danger btn-xs",onClick:this.onClosePoolConfig.bind(this,r)},"关闭"))):React.createElement("div",{className:"row"},React.createElement("div",{className:"col-xs-4 poolalert alert-danger text-center"},"状态: 关闭"),React.createElement("div",{className:"col-xs-2"},React.createElement("a",{id:s,href:"javascript:void(0);",className:"btn btn-info btn-xs",onClick:this.onOpenPoolConfig.bind(this,r)},"打开")))),o=this.getLocalTime(i.create_tsp),u=React.createElement("div",{className:"btn-group btn-group-xs",role:"group","aria-label":""},React.createElement("button",{type:"button",href:"javascript:void(0);",className:"btn btn-success",onClick:this.onClickSetDefUpPool.bind(this,i)},React.createElement("i",{className:"icon-bookmark"})," 默认卡池"),React.createElement("button",{type:"button",herf:"javascript:void(0);",className:"btn btn-primary",onClick:this.onClickSetPubUsePool.bind(this,i)},React.createElement("i",{className:"icon-group"})," 公共卡池")),r==n&&r!=t?u=React.createElement("button",{type:"button",href:"javascript:void(0);",className:"btn btn-success",onClick:this.onClickSetDefUpPool.bind(this,i)},React.createElement("i",{className:"icon-bookmark"})," 默认卡池"):r==t&&r!=n?u=React.createElement("button",{type:"button",herf:"javascript:void(0);",className:"btn btn-primary",onClick:this.onClickSetPubUsePool.bind(this,i)},React.createElement("i",{className:"icon-group"})," 公共卡池"):r==t&&r==n&&(u=null),f=null,r!=t&&r!=n&&(f=React.createElement("button",{type:"button",href:"javascript:void(0);",className:"btn btn-danger",onClick:this.onDelPool.bind(this,i)},React.createElement("i",{className:"icon-trash"})," 删除")),React.createElement("tr",null,React.createElement("td",null,r),React.createElement("td",null,o),React.createElement("td",null,e),React.createElement("td",null,React.createElement("div",{className:"btn-toolbar pull-right",role:"toolbar","aria-label":""},React.createElement("div",{className:"btn-group btn-group-xs",role:"group","aria-label":""},f),React.createElement("div",{className:"btn-group btn-group-xs",role:"group","aria-label":""},u))))}.bind(this));return React.createElement("div",{className:"wrapper"},React.createElement("div",{className:"col-md-12"},React.createElement("section",{className:"panel"},React.createElement("header",{className:"panel-heading row"},React.createElement("span",{className:"pull-left"},React.createElement("i",{className:"icon-table"}),"卡池列表"),React.createElement("a",{className:"btn btn-info pull-right",href:"javascript:void(0);",onClick:this.onClickAddPool},React.createElement("i",{className:"icon-plus"})," 新增卡池")),React.createElement("div",{className:"col-xs-12"},React.createElement("h5",{className:"text-danger"},React.createElement("strong",null,React.createElement("i",{className:"icon-bookmark"})," 当前默认卡池： ",t)),React.createElement("h5",{className:"text-primary"},React.createElement("strong",null,React.createElement("i",{className:"icon-group"}),"当前公共卡池： ",n))),React.createElement("div",{className:"panel-body"},React.createElement("table",{className:"table table-striped table-hover"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"卡池名称"),React.createElement("th",null,"创建时间"),React.createElement("th",null,React.createElement("div",{className:"col-xs-4 text-right"},"状态")),React.createElement("th",null,React.createElement("div",{className:"col-xs-10 text-right"},"操作")))),React.createElement("tbody",null,i))))),React.createElement(AddPoolDlg,{ref:"AddPoolDlg"}))}}),AddPoolDlg=React.createClass({displayName:"AddPoolDlg",onOk:function(){var n=$("#new_pool_name").val(),t,i;for(t in this.state.pool_list)if(n==this.state.pool_list[t].pool_name){alert("这个名字已经被使用了， 换一个!!!");return}i={pool_name:n};this.state.onAddPool(i);this.hideDlg()},onInputKeyUp:function(n){$("#"+n).keydown(function(n){if(!n)var n=window.event;n.keyCode==32&&(n.preventDefault(),n.stopPropagation())});var t=$("#"+n).val();(t!=""||t!=null||t!="null")&&$("#addnewpoolbtn").removeClass("disabled");$("#"+n).val()},showDlg:function(n,t){this.setState({pool_list:n,onAddPool:t});$("#addPoolDlg").modal("show");$("#new_pool_name").val("");$("#addnewpoolbtn").addClass("disabled")},hideDlg:function(){$("#addPoolDlg").modal("hide");this.clearInput()},clearInput:function(){this.setState({pool_list:[],onAddPool:null});$("#new_pool_name").val("")},getInitialState:function(){return{pool_list:[],onAddPool:null}},componentDidUpdate:function(){},render:function(){return React.createElement("div",{className:"modal",id:"addPoolDlg",tabIndex:"-1",role:"dialog"},React.createElement("div",{className:"modal-dialog"},React.createElement("div",{className:"modal-content"},React.createElement("div",{className:"modal-header"},React.createElement("h5",{className:"modal-title"},"新增卡池")),React.createElement("div",{className:"modal-body form-horizontal"},React.createElement("div",{className:"form-group add-pro-body"},React.createElement("label",{className:"col-md-2 control-label"},"卡池名称"),React.createElement("div",{className:"col-md-10"},React.createElement("input",{maxLength:"15",className:"m-bot15 form-control input-sm",id:"new_pool_name",onBlur:this.onInputKeyUp.bind(this,"new_pool_name"),onKeyUp:this.onInputKeyUp.bind(this,"new_pool_name"),placeholder:"请输入卡池名称"})))),React.createElement("div",{className:"modal-footer form-horifooter"},React.createElement("button",{id:"addnewpoolbtn",type:"button",className:"btn btn-danger",onClick:this.onOk},"新建"),React.createElement("button",{type:"button",className:"btn btn-default","data-dismiss":"modal"},"取消")))))}});React.render(React.createElement(MainContent,null),document.getElementById("main-content"));